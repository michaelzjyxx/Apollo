# iFinD行业筛选自动化系统需求文档

**版本**: v1.0
**日期**: 2026-01-18
**状态**: 待确认

---

## 一、项目概述

### 1.1 项目目标
基于iFinD数据源，开发一套全自动化的A股行业筛选系统，通过API接口实现数据获取、指标计算、行业评分、可视化展示、定期更新和策略回测的完整闭环。

### 1.2 核心价值
- **自动化**: 替代手工Excel操作，减少人工干预
- **实时性**: 通过API实时/定期获取最新数据
- **可回测**: 基于历史数据验证筛选策略有效性
- **可视化**: 直观展示行业评分及变化趋势
- **可扩展**: 便于后续增加个股筛选、组合构建等功能

### 1.3 覆盖范围
- **行业分类**: 申万一级31个行业
- **数据指标**: 23个定量指标 + 4个定性指标（详见[行业筛选指标数据获取指南](./行业筛选指标数据获取指南.md)）
- **评分体系**: 100分制（70分定量 + 20分定性 + 10分调整）
- **更新频率**: 季度（财务数据）+ 月度（景气指标）+ 周度（估值/资金）

---

## 二、技术架构（建议方案）

### 2.1 技术栈推荐

| 层级 | 技术选型 | 说明 |
|-----|---------|------|
| **数据源** | iFinD API (同花顺) | 88%指标覆盖，性价比高 |
| **开发语言** | Python 3.9+ | 数据处理生态成熟 |
| **数据存储** | SQLite / MySQL | SQLite适合个人，MySQL适合多人协作 |
| **计算框架** | Pandas + NumPy | 数据处理标准库 |
| **可视化** | Plotly / Matplotlib + Streamlit | 交互式仪表板 |
| **调度系统** | APScheduler / Airflow | APScheduler简单，Airflow功能强大 |
| **回测框架** | 自研（基于历史评分）| 简单策略自研即可 |

### 2.2 系统架构图（文字描述）

```
┌─────────────┐
│  iFinD API  │ ← 数据源
└──────┬──────┘
       │
       ↓
┌──────────────────────────────┐
│  数据获取模块 (Data Fetcher)   │
│  - API调用封装                │
│  - 数据验证与清洗              │
│  - 异常处理与重试              │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  数据存储 (Database)          │
│  - 原始数据表                 │
│  - 计算结果表                 │
│  - 历史评分表                 │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  计算引擎 (Calculator)        │
│  - 23个定量指标计算           │
│  - 历史分位计算               │
│  - 红线触发检测               │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  评分引擎 (Scoring Engine)    │
│  - 竞争格局评分 (15分)        │
│  - 盈利能力评分 (15分)        │
│  - 成长性评分 (10分)          │
│  - 现金流评分 (10分)          │
│  - 估值评分 (10分)            │
│  - 景气度评分 (5分)           │
│  - 周期位置评分 (5分)         │
│  - 定性评分 (20分)            │
│  - 红线扣分 (-10分)           │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  可视化模块 (Visualization)   │
│  - 行业评分仪表板             │
│  - 指标雷达图                 │
│  - 历史趋势图                 │
│  - 红线预警面板               │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  定时更新模块 (Scheduler)     │
│  - 财务数据季度更新           │
│  - 景气指标月度更新           │
│  - 估值数据周度更新           │
└──────┬───────────────────────┘
       │
       ↓
┌──────────────────────────────┐
│  回测模块 (Backtester)        │
│  - 历史评分回溯               │
│  - 策略收益计算               │
│  - 有效性验证                 │
└──────────────────────────────┘
```

---

## 三、功能需求详细说明

### 3.1 数据获取模块 (Data Fetcher)

#### 3.1.1 核心功能
- 通过iFinD API获取23个定量指标的原始数据
- 覆盖31个申万一级行业
- 支持历史数据批量获取（用于回测）
- 支持增量更新（仅获取新数据）

#### 3.1.2 需要获取的数据类型（23类）

**请确认以下数据需求是否完整：**

| 序号 | 指标类别 | 具体指标 | 数据频率 | 历史长度 |
|-----|---------|---------|---------|---------|
| 1 | 竞争格局 | 行业集中度CR5 | 年度 | 5年 |
| 2 | 竞争格局 | 龙头市场份额变化 | 年度 | 3年 |
| 3 | 竞争格局 | 价格波动率（代表性产品价格） | 月度 | 2年 |
| 4 | 竞争格局 | 产能利用率 | 季度 | 2年 |
| 5 | 盈利能力 | 行业平均ROE | 季度(TTM) | 5年 |
| 6 | 盈利能力 | 行业平均毛利率 | 季度(TTM) | 5年 |
| 7 | 成长性 | 行业收入增速 | 季度(TTM) | 5年 |
| 8 | 成长性 | 行业利润增速 | 季度(TTM) | 5年 |
| 9 | 现金流 | 经营性现金流/净利润 | 季度(TTM) | 3年 |
| 10 | 现金流 | 资本支出强度(Capex/折旧) | 季度(TTM) | 3年 |
| 11 | 估值 | 行业PE-TTM | 日度 | 5年 |
| 12 | 估值 | 行业PB | 日度 | 5年 |
| 13 | 估值 | 行业净利润增速(一致预期) | 月度 | 1年 |
| 14 | 景气度 | 制造业PMI | 月度 | 3年 |
| 15 | 景气度 | 新订单指数 | 月度 | 3年 |
| 16 | 景气度 | M2同比增速 | 月度 | 3年 |
| 17 | 景气度 | 社融同比增速 | 月度 | 3年 |
| 18 | 景气度 | PPI同比 | 月度 | 3年 |
| 19 | 景气度 | CPI同比 | 月度 | 3年 |
| 20 | 周期位置 | 存货同比 | 季度 | 3年 |
| 21 | 周期位置 | 库存周转天数 | 季度 | 3年 |
| 22 | 资金流向 | 北向资金行业流入 | 周度 | 1年 |
| 23 | 资金流向 | 主力资金行业流入 | 周度 | 1年 |

**❓ 确认问题1**: 以上23个指标及其数据频率、历史长度是否符合您的需求？是否需要调整？
如果要回测的话，是否有必要存储更长时间的数据。比如直接一次性把 ifind 的历史数据都取到，后续就直接从数据库里取数据就好了。但是需要考虑后续需要自动新增更新新数据
且需要考虑后续拓展性，比如要新增数据指标

#### 3.1.3 数据验证规则
- **完整性检查**: 缺失值比例 < 10%
- **合理性检查**:
  - ROE范围：-100% ~ 100%
  - 毛利率范围：0% ~ 100%
  - PE范围：>0（剔除负值）
  - PB范围：>0
- **时效性检查**: 数据日期与当前日期差异不超过规定阈值
  - 季度数据：不超过4个月
  - 月度数据：不超过2个月
  - 周度数据：不超过2周

**❓ 确认问题2**: 数据验证规则是否需要补充或调整？
不用

#### 3.1.4 异常处理机制
- API调用失败：自动重试3次，间隔5秒
- 数据缺失：记录日志，使用上期数据或行业中位数填充
- 数据异常：标记为异常值，不参与计算

**❓ 确认问题3**: 异常处理机制是否合理？
需要考虑 API 调用的频率限制，也做成参数可配吧

---

### 3.2 数据存储模块 (Database)

#### 3.2.1 数据库表结构（建议）

**表1: raw_data（原始数据表）**
```sql
CREATE TABLE raw_data (
    id INTEGER PRIMARY KEY,
    industry_code VARCHAR(10),      -- 行业代码（如801010.SI）
    industry_name VARCHAR(50),      -- 行业名称（如农林牧渔）
    indicator_code VARCHAR(20),     -- 指标代码（如ROE、CR5）
    indicator_value FLOAT,          -- 指标值
    data_date DATE,                 -- 数据日期
    update_time TIMESTAMP,          -- 更新时间
    data_source VARCHAR(20)         -- 数据来源（iFinD）
);
```

**表2: calculated_indicators（计算指标表）**
```sql
CREATE TABLE calculated_indicators (
    id INTEGER PRIMARY KEY,
    industry_code VARCHAR(10),
    industry_name VARCHAR(50),
    calc_date DATE,                 -- 计算日期

    -- 竞争格局指标
    cr5 FLOAT,
    leader_share_change FLOAT,
    price_volatility FLOAT,
    capacity_utilization FLOAT,

    -- 盈利能力指标
    roe_avg FLOAT,
    roe_percentile FLOAT,           -- ROE历史分位
    gross_margin_avg FLOAT,

    -- 成长性指标
    revenue_growth FLOAT,
    profit_growth FLOAT,

    -- 现金流指标
    ocf_ni_ratio FLOAT,
    capex_intensity FLOAT,

    -- 估值指标
    pe_ttm FLOAT,
    pe_percentile FLOAT,
    pb FLOAT,
    pb_percentile FLOAT,
    peg FLOAT,

    -- 景气度指标
    pmi FLOAT,
    new_order FLOAT,
    m2_growth FLOAT,
    social_financing_growth FLOAT,
    ppi_yoy FLOAT,
    cpi_yoy FLOAT,

    -- 周期位置指标
    inventory_yoy FLOAT,
    inventory_turnover_days FLOAT,
    inventory_cycle_position VARCHAR(20),  -- 库存周期位置

    -- 资金流向
    northbound_flow_4w FLOAT,      -- 北向资金4周流入
    main_fund_flow_4w FLOAT,       -- 主力资金4周流入

    update_time TIMESTAMP
);
```

**表3: scores（评分表）**
```sql
CREATE TABLE scores (
    id INTEGER PRIMARY KEY,
    industry_code VARCHAR(10),
    industry_name VARCHAR(50),
    score_date DATE,

    -- 分项得分（定量70分）
    competition_score FLOAT,        -- 竞争格局 15分
    profitability_score FLOAT,      -- 盈利能力 15分
    growth_score FLOAT,             -- 成长性 10分
    cashflow_score FLOAT,           -- 现金流 10分
    valuation_score FLOAT,          -- 估值 10分
    sentiment_score FLOAT,          -- 景气度 5分
    cycle_score FLOAT,              -- 周期位置 5分

    -- 定性评分（20分）
    policy_score FLOAT,             -- 政策环境 5分
    business_model_score FLOAT,     -- 商业模式 5分
    barrier_score FLOAT,            -- 进入壁垒 5分
    moat_score FLOAT,               -- 护城河 5分

    -- 调整分（±10分）
    macro_adjustment FLOAT,         -- 宏观调整 ±5分
    redline_penalty FLOAT,          -- 红线扣分 -10分

    -- 总分
    total_score FLOAT,              -- 总分 100分

    -- 红线触发
    redline_triggered VARCHAR(200), -- 触发的红线项

    update_time TIMESTAMP
);
```

**表4: backtest_results（回测结果表）**
```sql
CREATE TABLE backtest_results (
    id INTEGER PRIMARY KEY,
    backtest_date DATE,             -- 回测日期
    strategy_name VARCHAR(50),      -- 策略名称
    selected_industries VARCHAR(500), -- 选中的行业（逗号分隔）
    portfolio_return FLOAT,         -- 组合收益率
    benchmark_return FLOAT,         -- 基准收益率（如沪深300）
    alpha FLOAT,                    -- 超额收益
    sharpe_ratio FLOAT,             -- 夏普比率
    max_drawdown FLOAT,             -- 最大回撤
    update_time TIMESTAMP
);
```

**❓ 确认问题4**: 数据库表结构是否满足需求？是否需要增加或删减字段？
满足。但需要考虑各表后续可能有新增指标等

#### 3.2.2 数据库选择
**选项A: SQLite（推荐个人使用）**
- 优点：轻量级，无需安装，文件存储
- 缺点：不支持多用户并发

**选项B: MySQL（适合团队协作）**
- 优点：支持多用户，性能好
- 缺点：需要安装配置

**❓ 确认问题5**: 选择SQLite还是MySQL？
mySQL

---

### 3.3 计算引擎模块 (Calculator)

#### 3.3.1 计算流程
```
原始数据 → 数据清洗 → 指标计算 → 历史分位计算 → 库存周期判断 → 结果存储
```

#### 3.3.2 重点计算逻辑

**1) 历史分位计算**
```python
# 伪代码示例
def calculate_percentile(current_value, historical_values, period='5Y'):
    """
    计算当前值在历史数据中的分位数

    Args:
        current_value: 当前值
        historical_values: 历史数据（如过去5年的PE）
        period: 历史周期（'5Y', '3Y'等）

    Returns:
        percentile: 0-100的分位数
    """
    percentile = (historical_values < current_value).sum() / len(historical_values) * 100
    return percentile
```

**2) 库存周期判断**
```python
def determine_inventory_cycle(inventory_yoy, revenue_yoy):
    """
    判断库存周期位置

    Args:
        inventory_yoy: 存货同比增速
        revenue_yoy: 营收同比增速

    Returns:
        position: 库存周期位置
    """
    if inventory_yoy < -5 and revenue_yoy < 0:
        return "主动去库存（景气底部）"
    elif inventory_yoy > 5 and revenue_yoy > 10:
        return "被动补库存（景气上行）"
    elif inventory_yoy > 10 and revenue_yoy > 5:
        return "主动补库存（景气高位）"
    elif inventory_yoy < 0 and revenue_yoy < -5:
        return "被动去库存（景气下行）"
    else:
        return "过渡期"
```

**3) PEG计算**
```python
def calculate_peg(pe, profit_growth):
    """
    计算PEG

    Args:
        pe: 市盈率
        profit_growth: 利润增速(%)

    Returns:
        peg: PE/增速
    """
    if profit_growth <= 0:
        return None  # 负增长不适用PEG
    return pe / profit_growth
```

**❓ 确认问题6**: 计算逻辑是否符合预期？是否需要补充其他计算方法？
符合，不用。但需要考虑后续可能新增计算方案

---

### 3.4 评分引擎模块 (Scoring Engine)

#### 3.4.1 评分规则详细说明

**竞争格局（15分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| CR5集中度 | 5分 | >60%: 5分; 40-60%: 4分; 20-40%: 2分; <20%: 0分 |
| 龙头份额变化 | 5分 | 持续提升(+0.5pct/年): 5分; 稳定(±0.3pct): 3分; 下降(-0.5pct/年): 0分 |
| 价格稳定性 | 3分 | CV<10%: 3分; 10-20%: 2分; >20%: 0分 |
| 产能利用率 | 2分 | >85%: 2分; 70-85%: 1分; <70%: 0分 |

**盈利能力（15分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| ROE水平 | 8分 | >全A中位数且>历史50%分位: 8分; 满足一项: 4分; 都不满足: 0分 |
| ROE趋势 | 3分 | 环比改善: 3分; 平稳: 2分; 下行: 0分 |
| 毛利率水平 | 2分 | >自身5年均值: 2分; 否则: 0分 |
| 毛利率趋势 | 2分 | 上行: 2分; 平稳: 1分; 下行: 0分 |

**成长性（10分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| 收入增速 | 5分 | >GDP+3%: 5分; >GDP: 3分; >0%: 1分; <0%: 0分 |
| 利润增速 | 3分 | >收入增速: 3分; 与收入同步: 2分; <收入增速: 0分 |
| 利润弹性 | 2分 | >1.2: 2分; 0.8-1.2: 1分; <0.8: 0分 |

**现金流（10分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| OCF/NI比值 | 6分 | >100%: 6分; 80-100%: 4分; 50-80%: 2分; <50%: 0分 |
| 资本支出强度 | 4分 | 1-2: 4分; 0.8-1或2-3: 2分; <0.8或>3: 0分 |

**估值（10分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| PE历史分位 | 4分 | <30%: 4分; 30-50%: 3分; 50-70%: 1分; >70%: 0分 |
| PB历史分位 | 3分 | <30%: 3分; 30-50%: 2分; 50-70%: 1分; >70%: 0分 |
| PEG | 3分 | <1: 3分; 1-1.5: 2分; 1.5-2: 1分; >2: 0分 |

**景气度（5分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| PMI/新订单 | 2分 | PMI>50且新订单>51: 2分; 一项满足: 1分; 都不满足: 0分 |
| M2/社融 | 1.5分 | >10%: 1.5分; 8-10%: 1分; <8%: 0分 |
| PPI/CPI | 1.5分 | 符合行业特性(周期看PPI,消费看CPI): 1.5分; 否则: 0分 |

**周期位置（5分）**

| 子项 | 权重 | 评分标准 |
|-----|------|---------|
| 库存周期 | 3分 | 被动补库存: 3分; 主动去库存: 2分; 过渡期: 1分; 其他: 0分 |
| 库存周转 | 2分 | 周转天数环比下降: 2分; 上升<10%: 1分; 上升>20%: 0分 |

**定性评分（20分）**
- 政策环境：5分（需人工评估）
- 商业模式：5分（需人工评估）
- 进入壁垒：5分（需人工评估）
- 护城河深度：5分（需人工评估）

**红线扣分（-10分）**
- 毛利率连续4季度下滑>5pct：-10分
- 收入连续2季度下滑>20%：-10分
- PE/PB历史95%分位以上维持1月：-10分
- 北向+主力资金连续8周流出>100亿：-10分

**❓ 确认问题7**: 评分规则是否需要调整？各子项权重是否合理？
把这些权重的分变成参数可配置，方便后续调整策略

#### 3.4.2 定性评分输入方式

**选项A: 手工录入（推荐初期）**
- 在可视化界面提供表单，人工输入4项定性评分
- 存储在scores表中

**选项B: 预设评分库**
- 建立行业定性评分预设库（基于行业研报总结）
- 定期（如半年）人工更新

**❓ 确认问题8**: 定性评分采用哪种方式？
B

---

### 3.5 可视化模块 (Visualization)

#### 3.5.1 核心看板需求

**看板1: 行业评分总览**
- 展示31个行业的总分排名（柱状图或表格）
- 支持按分数排序、按行业名称筛选
- 高亮显示触发红线的行业（红色标注）
- 显示最新更新时间

**看板2: 单行业详情页**
- 雷达图：展示7个维度的分项得分
- 指标明细表：23个定量指标的具体数值及历史分位
- 红线预警：如有触发，显示具体触发项
- 定性评分：4项定性评分及说明

**看板3: 历史趋势分析**
- 折线图：某行业总分的历史变化（如过去8个季度）
- 对比图：多个行业总分对比
- 分项得分堆叠图：各维度得分的变化趋势

**看板4: 红线监控面板**
- 实时显示所有触发红线的行业
- 分类统计：毛利率红线、收入红线、估值红线、资金红线
- 预警等级：红色（立即调出）、黄色（预警观察）

**❓ 确认问题9**: 以上看板是否满足需求？是否需要增加其他可视化？
满足

#### 3.5.2 技术实现方案

**选项A: Streamlit（推荐）**
- 优点：开发快速，交互性强，Python原生
- 缺点：需本地运行或云端部署

**选项B: Jupyter Notebook + Plotly**
- 优点：适合探索性分析
- 缺点：交互性较弱

**选项C: Web应用（Flask/Django）**
- 优点：专业，可定制性强
- 缺点：开发周期长

**❓ 确认问题10**: 选择哪种可视化方案？
Streamlit
---

### 3.6 定时更新模块 (Scheduler)

#### 3.6.1 更新策略

| 数据类型 | 更新频率 | 触发时间 | 说明 |
|---------|---------|---------|------|
| **季度财务数据** | 季度 | 季报披露后第5个工作日 | ROE、毛利率、现金流等 |
| **月度景气指标** | 月度 | 每月15日 | PMI、PPI、CPI、M2、社融 |
| **周度估值/资金** | 周度 | 每周一上午9点 | PE、PB、北向资金、主力资金 |
| **年度竞争格局** | 年度 | 年报披露后第10个工作日 | CR5、市场份额 |

**❓ 确认问题11**: 更新频率和触发时间是否合理？
合理

#### 3.6.2 更新流程
```
定时触发 → 检查新数据可用性 → 调用数据获取模块 → 存储原始数据
→ 调用计算引擎 → 调用评分引擎 → 更新可视化看板 → 发送通知（可选）
```

#### 3.6.3 通知机制（可选）

**选项A: 邮件通知**
- 更新完成后发送邮件摘要
- 红线触发时立即发送预警邮件

**选项B: 微信/钉钉通知**
- 通过企业微信/钉钉机器人推送

**选项C: 无通知**
- 仅在看板中展示

**❓ 确认问题12**: 是否需要通知机制？选择哪种方式？

---

### 3.7 回测模块 (Backtester)

#### 3.7.1 回测目标
验证行业筛选评分体系的有效性，即：
- 高分行业（如>70分）是否在后续期间跑赢大盘？
- 评分是否具有预测性？

#### 3.7.2 回测逻辑

**策略1: 季度轮动策略**
```
每季度末（如3/31, 6/30, 9/30, 12/31）：
1. 计算所有行业评分
2. 选择TOP N个行业（如N=5或N=10）
3. 等权配置（或按评分加权）
4. 持有至下季度末
5. 重新计算评分并调仓
```

**策略2: 动态调整策略**
```
每月监控：
- 如有行业触发红线，立即剔除
- 如有新行业评分进入TOP N，替换最低分行业
```

**❓ 确认问题13**: 采用哪种回测策略？是否需要定制？
策略 2

#### 3.7.3 收益计算方式

**方案A: 使用行业指数收益**
- 获取申万行业指数（如801010.SI）的历史涨跌幅
- 计算组合加权收益
- 对比基准：沪深300或中证800

**方案B: 使用行业龙头股收益**
- 选择每个行业市值前3名个股
- 计算平均收益

**❓ 确认问题14**: 收益计算采用哪种方式？
方案B

#### 3.7.4 回测周期
- 回测起始时间：2018-01-01（覆盖完整牛熊周期）
- 回测结束时间：当前最新季度
- 回测频率：季度调仓

**❓ 确认问题15**: 回测周期是否合理？
可以

#### 3.7.5 回测输出指标
- 累计收益率
- 年化收益率
- 超额收益（Alpha）
- 夏普比率
- 最大回撤
- 胜率（跑赢基准的季度占比）
- 换手率

**❓ 确认问题16**: 回测输出指标是否需要补充？
无

---

## 四、非功能性需求

### 4.1 性能要求
- 单次全量数据更新（31个行业×23个指标）：< 10分钟
- 单次评分计算：< 1分钟
- 可视化看板加载：< 3秒
- 回测计算（5年数据）：< 30秒

**❓ 确认问题17**: 性能要求是否合理？
OK

### 4.2 可维护性
- 代码结构：模块化设计，各模块独立
- 配置管理：所有参数（如评分权重、阈值）可配置化，存储在配置文件中
- 日志记录：关键操作记录日志（数据获取、计算、更新）
- 错误追踪：异常情况记录详细堆栈信息

### 4.3 可扩展性
- 预留个股筛选接口（未来可基于行业评分进一步筛选个股）
- 预留多因子扩展（未来可增加技术面、资金面因子）
- 预留多策略回测框架

**❓ 确认问题18**: 是否需要在初期就考虑个股筛选功能？
要
---

## 五、实施计划

### 5.1 开发阶段划分（建议）

**Phase 1: 数据获取与存储（2-3周）**
- iFinD API对接与封装
- 数据库设计与建表
- 数据获取脚本开发
- 数据验证与清洗

**Phase 2: 计算与评分引擎（2周）**
- 23个指标计算逻辑实现
- 评分引擎开发
- 单元测试

**Phase 3: 可视化（1-2周）**
- 4个核心看板开发
- 交互功能实现

**Phase 4: 定时更新（1周）**
- 调度系统搭建
- 更新流程测试

**Phase 5: 回测模块（2周）**
- 回测框架开发
- 历史数据回溯
- 策略有效性验证

**Phase 6: 测试与优化（1周）**
- 集成测试
- 性能优化
- 文档编写

**总计：9-11周**

**❓ 确认问题19**: 开发周期是否可接受？是否需要调整优先级？
可忽略

### 5.2 优先级建议

**P0（核心功能，必须实现）**
- 数据获取模块
- 计算引擎
- 评分引擎
- 基础可视化（行业评分总览）

**P1（重要功能，尽快实现）**
- 定时更新
- 红线监控
- 详细可视化看板

**P2（增强功能，后期优化）**
- 回测模块
- 通知机制
- 高级可视化

**❓ 确认问题20**: 优先级划分是否合理？
合理

---

## 六、成本估算

### 6.1 数据成本
- **iFinD API费用**: 10,000-20,000元/年（根据API调用量）

### 6.2 开发成本（如外包）
- **开发人力**: 1名Python开发工程师，2-3个月
- **预估费用**: 3-5万元（按市场价）

### 6.3 运维成本
- **服务器**: 如需云端部署，约500-1000元/月
- **维护**: 定期更新与问题修复

**❓ 确认问题21**: 成本预算是否在可接受范围内？
忽略

---

## 七、风险与限制

### 7.1 数据风险
- **iFinD API限制**: 部分指标可能无法通过API获取，需手工补充
- **数据质量**: 部分行业数据缺失或延迟

### 7.2 技术风险
- **API变更**: iFinD API接口可能变更，需及时适配
- **性能瓶颈**: 大量历史数据可能导致计算缓慢

### 7.3 策略风险
- **回测过拟合**: 评分体系基于历史数据优化,可能不适用未来
- **定性评分主观性**: 定性评分依赖人工判断，存在偏差

**❓ 确认问题22**: 以上风险是否可接受？是否有补充？
可以

---

## 八、待确认事项汇总

为便于您确认，以下是所有待确认问题：

| 编号 | 问题 | 选项/说明 |
|-----|------|----------|
| 1 | 23个指标及数据频率是否完整？ | 见3.1.2表格 |
| 2 | 数据验证规则是否合理？ | 见3.1.3 |
| 3 | 异常处理机制是否合理？ | 见3.1.4 |
| 4 | 数据库表结构是否满足需求？ | 见3.2.1 |
| 5 | 选择SQLite还是MySQL？ | SQLite/MySQL |
| 6 | 计算逻辑是否符合预期？ | 见3.3.2 |
| 7 | 评分规则及权重是否合理？ | 见3.4.1 |
| 8 | 定性评分采用哪种方式？ | 手工录入/预设评分库 |
| 9 | 可视化看板是否满足需求？ | 见3.5.1 |
| 10 | 选择哪种可视化方案？ | Streamlit/Jupyter/Web应用 |
| 11 | 更新频率和触发时间是否合理？ | 见3.6.1 |
| 12 | 是否需要通知机制？ | 邮件/微信/钉钉/无 |
| 13 | 采用哪种回测策略？ | 季度轮动/动态调整 |
| 14 | 收益计算采用哪种方式？ | 行业指数/龙头股 |
| 15 | 回测周期是否合理？ | 2018-01-01至今 |
| 16 | 回测输出指标是否需要补充？ | 见3.7.5 |
| 17 | 性能要求是否合理？ | 见4.1 |
| 18 | 是否初期就考虑个股筛选？ | 是/否 |
| 19 | 开发周期是否可接受？ | 9-11周 |
| 20 | 优先级划分是否合理？ | 见5.2 |
| 21 | 成本预算是否可接受？ | 见6章 |
| 22 | 风险是否可接受？ | 见7章 |

---

## 九、下一步行动

### 9.1 您需要做的
1. **审阅本需求文档**，对22个确认问题给出明确答复
2. **补充或调整**任何不符合预期的内容
3. **明确优先级**：哪些功能必须在第一版实现，哪些可以后续迭代

### 9.2 确认后的工作
1. 根据您的反馈修订需求文档（如需要）
2. 开始技术选型与架构设计
3. 进行iFinD API可行性测试（验证数据是否可获取）
4. 制定详细的开发计划与时间表
5. 开始Phase 1开发

---

## 十、附录

### 10.1 参考文档
- [行业筛选指标数据获取指南](./行业筛选指标数据获取指南.md)
- [行业筛选框架](./1：行业筛选.md)
- [iFinD行业筛选数据获取与评分落地方案](./iFinD行业筛选数据获取与评分落地方案.md)（Excel方案，供参考）

### 10.2 术语表
- **TTM**: Trailing Twelve Months，最近12个月
- **CR5**: Concentration Ratio 5，前5名企业集中度
- **PEG**: PE / Growth，市盈率相对盈利增长比
- **OCF**: Operating Cash Flow，经营性现金流
- **Capex**: Capital Expenditure，资本支出
- **D&A**: Depreciation & Amortization，折旧与摊销
- **PMI**: Purchasing Managers' Index，采购经理人指数
- **M2**: 广义货币供应量
- **社融**: 社会融资规模
- **PPI**: Producer Price Index，工业品出厂价格指数
- **CPI**: Consumer Price Index，居民消费价格指数

---

**文档结束**

**请您逐一确认以上22个问题，我将根据您的反馈进行调整，然后开始实施开发。**
